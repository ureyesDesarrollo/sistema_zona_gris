<!doctype html>
<html lang="es" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zona Gris · Horas por Cocedor</title>

  <!-- Bootstrap 5 (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Librería para exportar a PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      --zg-primary: #3498DB;
      --zg-primary-50: #ebf5fb;
      --zg-soft-shadow: 0 10px 30px rgba(0,0,0,.06);
      --zg-radius: 1rem;
    }
    body { 
      background: linear-gradient(180deg, #f8fbff 0%, #ffffff 100%);
      min-height: 100vh;
    }
    .zg-header {
      background: linear-gradient(135deg, var(--zg-primary) 0%, #4fb3ff 100%);
      border: 0;
      border-radius: 1.25rem;
      color: #fff;
      box-shadow: var(--zg-soft-shadow);
    }
    .zg-toolbar {
      position: sticky; top: .75rem; z-index: 20;
      background: #fff; border: 1px solid #eef2f7; border-radius: var(--zg-radius);
      box-shadow: var(--zg-soft-shadow);
    }
    .zg-hour-card {
      border: 1px solid #eef2f7; border-radius: var(--zg-radius);
      box-shadow: var(--zg-soft-shadow);
      page-break-inside: avoid; /* Para impresión */
    }
    .zg-hour-card .card-header {
      background: #fff; border-bottom: 1px solid #eef2f7;
    }
    .zg-badge-fo {
      background: #f1f3f5; color: #6c757d; border: 1px dashed #dadfe4;
      font-weight: 600;
    }
    .zg-table-wrap { overflow-x: auto; }
    table.zg-matrix { min-width: 880px; }
    .zg-matrix th.sticky-col { position: sticky; left: 0; z-index: 2; background: #fff; }
    .zg-matrix thead th { position: sticky; top: 0; z-index: 3; background: #fff; }
    .zg-compact td, .zg-compact th { padding: .35rem .5rem; font-size: .85rem; }
    .zg-out { background: #fde2e2 !important; }
    .zg-borderline { background: #fff7e6 !important; }
    .zg-ok { background: #eefaf0 !important; }
    .zg-meta { font-size: .9rem; color: #6c757d; }
    .zg-summary .badge { font-weight: 600; }
    
    /* Mejoras para impresión */
    @media print {
      body { background: white !important; }
      .zg-header, .zg-toolbar, .btn, .form-check, .zg-summary .btn {
        display: none !important;
      }
      .zg-hour-card {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
        margin-bottom: 1rem;
      }
      .collapse {
        display: block !important;
        opacity: 1 !important;
      }
      .zg-table-wrap {
        overflow: visible !important;
      }
      .card-header {
        border-bottom: 2px solid #333 !important;
      }
      .badge {
        border: 1px solid #888 !important;
        color: #333 !important;
        background-color: transparent !important;
      }
      .zg-matrix th.sticky-col, .zg-matrix thead th {
        position: static !important;
        background: #f8f8f8 !important;
      }
    }
    
    /* Mejoras visuales */
    .zg-loading {
      display: none;
      text-align: center;
      padding: 2rem;
    }
    .zg-export-buttons {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--zg-primary-50);
      border-radius: var(--zg-radius);
    }
    .zg-info-badge {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container py-4 py-md-5">
    <div class="p-4 p-md-5 mb-4 zg-header">
      <div class="d-flex align-items-start align-items-md-center flex-column flex-md-row gap-3 justify-content-between">
        <div>
          <h1 class="h3 mb-1">Registros hora por hora · Cocedores</h1>
          <p class="mb-0">Vista interactiva por día y hora con parámetros por cocedor (C1–C7).</p>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="badge bg-light text-dark">Versión UI · Demo</span>
          <span class="badge bg-light text-dark zg-info-badge" data-bs-toggle="modal" data-bs-target="#infoModal">
            <i class="bi bi-info-circle"></i>
          </span>
        </div>
      </div>
    </div>

    <!-- Toolbar / Filtros -->
    <div class="zg-toolbar p-3 mb-4">
      <form id="filters" class="row g-3">
        <div class="col-12 col-md-3">
          <label class="form-label mb-1">Orden</label>
          <select class="form-select" id="sortOrder">
            <option value="desc">Más reciente primero</option>
            <option value="asc">Más antiguo primero</option>
          </select>
        </div>
        <div class="col-12 col-md-5">
          <label class="form-label mb-1">Cocedores a mostrar</label>
          <div class="d-flex flex-wrap gap-2">
            <!-- checkboxes C1..C7 -->
            <div class="form-check me-2">
              <input class="form-check-input" type="checkbox" value="1" id="c1" checked>
              <label class="form-check-label" for="c1">C1</label>
            </div>
            <div class="form-check me-2">
              <input class="form-check-input" type="checkbox" value="2" id="c2" checked>
              <label class="form-check-label" for="c2">C2</label>
            </div>
            <div class="form-check me-2">
              <input class="form-check-input" type="checkbox" value="3" id="c3" checked>
              <label class="form-check-label" for="c3">C3</label>
            </div>
            <div class="form-check me-2">
              <input class="form-check-input" type="checkbox" value="4" id="c4" checked>
              <label class="form-check-label" for="c4">C4</label>
            </div>
            <div class="form-check me-2">
              <input class="form-check-input" type="checkbox" value="5" id="c5" checked>
              <label class="form-check-label" for="c5">C5</label>
            </div>
            <div class="form-check me-2">
              <input class="form-check-input" type="checkbox" value="6" id="c6" checked>
              <label class="form-check-label" for="c6">C6</label>
            </div>
            <div class="form-check me-2">
              <input class="form-check-input" type="checkbox" value="7" id="c7" checked>
              <label class="form-check-label" for="c7">C7</label>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <label class="form-label mb-1">Opciones</label>
          <div class="d-flex flex-wrap align-items-center gap-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="toggleCompact">
              <label class="form-check-label" for="toggleCompact">Vista compacta</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="toggleHideFO">
              <label class="form-check-label" for="toggleHideFO">Ocultar FO</label>
            </div>
            <button type="button" id="btnReset" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-arrow-counterclockwise"></i> Restablecer
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Contenedor de resultados -->
    <div id="content"></div>
    
    <!-- Loading indicator -->
    <div id="loading" class="zg-loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Generando contenido...</p>
    </div>
    
    <!-- Botones de exportación -->
    <div class="zg-export-buttons" id="exportSection" style="display: none;">
      <div class="d-flex flex-wrap gap-2 justify-content-center">
        <button class="btn btn-success" id="btnExportPDF">
          <i class="bi bi-file-earmark-pdf"></i> Exportar a PDF
        </button>
        <button class="btn btn-primary" onclick="window.print()">
          <i class="bi bi-printer"></i> Imprimir
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de información -->
  <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">Información del sistema</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Leyenda de colores:</h6>
          <ul class="list-group mb-3">
            <li class="list-group-item"><span class="badge zg-ok me-2">OK</span> Valores dentro del rango normal</li>
            <li class="list-group-item"><span class="badge zg-borderline me-2">Borderline</span> Valores cerca de los límites (5%)</li>
            <li class="list-group-item"><span class="badge zg-out me-2">Fuera</span> Valores fuera del rango permitido</li>
            <li class="list-group-item"><span class="badge zg-badge-fo me-2">FO</span> Fuera de operación</li>
          </ul>
          <h6>Rangos de validación:</h6>
          <ul class="list-group">
            <li class="list-group-item">pH: 3.0 - 3.8</li>
            <li class="list-group-item">NTU: 60 - 600</li>
            <li class="list-group-item">Sólidos: 1.5% - 2.8%</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Data JSON: pega aquí tu arreglo si quieres cambiarlo dinámicamente -->
  <script id="data-json" type="application/json">
[
  {
    "dia": "2025-09-03","hora": "12:00","proceso": "10256","operador": "Francisco de Jesus Lopez Cervantes","supervisor": "Javier Villalobos",
    "c1_temp_entrada": "FO","c1_temp_salida": "FO","c1_solidos": "FO","c1_agua": "FO","c1_ntu": "FO","c1_ph": "FO",
    "c2_temp_entrada": "FO","c2_temp_salida": "FO","c2_solidos": "FO","c2_agua": "FO","c2_ntu": "FO","c2_ph": "FO",
    "c3_temp_entrada": "91","c3_temp_salida": "43","c3_solidos": "2","c3_agua": "1","c3_ntu": "400","c3_ph": "3.2",
    "c4_temp_entrada": "FO","c4_temp_salida": "FO","c4_solidos": "FO","c4_agua": "FO","c4_ntu": "FO","c4_ph": "FO",
    "c5_temp_entrada": "FO","c5_temp_salida": "FO","c5_solidos": "FO","c5_agua": "FO","c5_ntu": "FO","c5_ph": "FO",
    "c6_temp_entrada": "FO","c6_temp_salida": "FO","c6_solidos": "FO","c6_agua": "FO","c6_ntu": "FO","c6_ph": "FO",
    "c7_temp_entrada": "FO","c7_temp_salida": "FO","c7_solidos": "FO","c7_agua": "FO","c7_ntu": "FO","c7_ph": "FO"
  },
  {
    "dia": "2025-09-03","hora": "10:00","proceso": "10256","operador": "Francisco de Jesus Lopez Cervantes","supervisor": "Javier Villalobos",
    "c1_temp_entrada": "FO","c1_temp_salida": "FO","c1_solidos": "FO","c1_agua": "FO","c1_ntu": "FO","c1_ph": "FO",
    "c2_temp_entrada": "FO","c2_temp_salida": "FO","c2_solidos": "FO","c2_agua": "FO","c2_ntu": "FO","c2_ph": "FO",
    "c3_temp_entrada": "FO","c3_temp_salida": "FO","c3_solidos": "FO","c3_agua": "FO","c3_ntu": "FO","c3_ph": "FO",
    "c4_temp_entrada": "FO","c4_temp_salida": "FO","c4_solidos": "FO","c4_agua": "FO","c4_ntu": "FO","c4_ph": "FO",
    "c5_temp_entrada": "FO","c5_temp_salida": "FO","c5_solidos": "FO","c5_agua": "FO","c5_ntu": "FO","c5_ph": "FO",
    "c6_temp_entrada": "FO","c6_temp_salida": "FO","c6_solidos": "FO","c6_agua": "FO","c6_ntu": "FO","c6_ph": "FO",
    "c7_temp_entrada": "94","c7_temp_salida": "47","c7_solidos": "3","c7_agua": "1","c7_ntu": "600","c7_ph": "3.2"
  },
  {
    "dia": "2025-09-03","hora": "09:00","proceso": "10256","operador": "Francisco de Jesus Lopez Cervantes","supervisor": "Javier Villalobos",
    "c1_temp_entrada": "FO","c1_temp_salida": "FO","c1_solidos": "FO","c1_agua": "FO","c1_ntu": "FO","c1_ph": "FO",
    "c2_temp_entrada": "FO","c2_temp_salida": "FO","c2_solidos": "FO","c2_agua": "FO","c2_ntu": "FO","c2_ph": "FO",
    "c3_temp_entrada": "99","c3_temp_salida": "50","c3_solidos": "1.7","c3_agua": "1","c3_ntu": "200","c3_ph": "3.4",
    "c4_temp_entrada": "99","c4_temp_salida": "49","c4_solidos": "2","c4_agua": "1","c4_ntu": "200","c4_ph": "3",
    "c5_temp_entrada": "FO","c5_temp_salida": "FO","c5_solidos": "FO","c5_agua": "FO","c5_ntu": "FO","c5_ph": "FO",
    "c6_temp_entrada": "100","c6_temp_salida": "49","c6_solidos": "1","c6_agua": "1","c6_ntu": "1","c6_ph": "1",
    "c7_temp_entrada": "FO","c7_temp_salida": "FO","c7_solidos": "FO","c7_agua": "FO","c7_ntu": "FO","c7_ph": "FO"
  }
]
  </script>

  <script>
    // Inicializar jsPDF
    const { jsPDF } = window.jspdf;

    // ---- Configurable: rangos de validación por parámetro (ajústalos a tu proceso) ----
    const RANGES = {
      ph:        { min: 3.0, max: 3.8 },
      ntu:       { min: 60,  max: 600 },
      solidos:   { min: 1.5, max: 2.8 },
      agua:      null,               // sin rango (puedes agregarlo)
      temp_entrada: null,            // ej: { min: 85, max: 105 }
      temp_salida:  null
    };
    const FO_TOKEN = "FO"; // texto que representa "Fuera de operación"

    // ---- Utilidades ----
    const parseData = () => JSON.parse(document.getElementById('data-json').textContent.trim());
    const byHourAsc  = (a,b) => a.hora.localeCompare(b.hora);
    const byHourDesc = (a,b) => b.hora.localeCompare(a.hora);

    function classify(paramKey, raw) {
      if (raw === null || raw === undefined || raw === "") return { cls: "", label: "—", numeric: false };
      if (String(raw).toUpperCase() === FO_TOKEN) return { cls: "zg-badge-fo", label: FO_TOKEN, numeric: false };
      const val = Number(raw);
      if (Number.isNaN(val)) return { cls: "", label: raw, numeric: false };

      // Detecta el tipo de parámetro para tomar el rango
      let type = "other";
      if (paramKey.endsWith("_ph")) type = "ph";
      else if (paramKey.endsWith("_ntu")) type = "ntu";
      else if (paramKey.endsWith("_solidos")) type = "solidos";
      else if (paramKey.endsWith("_agua")) type = "agua";
      else if (paramKey.endsWith("_temp_entrada")) type = "temp_entrada";
      else if (paramKey.endsWith("_temp_salida")) type = "temp_salida";

      const range = RANGES[type] || null;
      if (!range) return { cls: "zg-ok", label: val.toString(), numeric: true };

      if (val < range.min || val > range.max) return { cls: "zg-out", label: val.toString(), numeric: true };
      // Borderline: dentro de rango pero cerca (<5% de los extremos)
      const span = range.max - range.min;
      const borderline = (val <= range.min + 0.05*span) || (val >= range.max - 0.05*span);
      return { cls: borderline ? "zg-borderline" : "zg-ok", label: val.toString(), numeric: true };
    }

    function buildHourSummary(rec, enabledCookers) {
      let totalPoints = 0, foCount = 0, outCount = 0, okCount = 0, borderlineCount = 0;
      enabledCookers.forEach(c => {
        const base = `c${c}_`;
        const keys = ["temp_entrada","temp_salida","solidos","agua","ntu","ph"].map(k => base+k);
        keys.forEach(k => {
          const raw = rec[k];
          const state = classify(k, raw);
          if (raw === undefined) return;
          totalPoints++;
          if (state.cls === "zg-badge-fo") foCount++;
          else if (state.cls === "zg-out") outCount++;
          else if (state.cls === "zg-borderline") borderlineCount++;
          else if (state.cls === "zg-ok") okCount++;
        });
      });
      return { totalPoints, foCount, outCount, borderlineCount, okCount };
    }

    function makeHourMatrix(rec, enabledCookers, compact = false, hideFO = false) {
      const params = [
        ["temp_entrada", "Temp entrada (°C)"],
        ["temp_salida",  "Temp salida (°C)"],
        ["solidos",      "Sólidos (%)"],
        ["agua",         "Agua (L/min)"],
        ["ntu",          "NTU"],
        ["ph",           "pH"]
      ];
      const table = document.createElement("table");
      table.className = `table table-hover align-middle mb-0 zg-matrix ${compact ? 'zg-compact' : ''}`;

      // Head
      const thead = document.createElement("thead");
      const hr = document.createElement("tr");
      const h0 = document.createElement("th");
      h0.className = "sticky-col";
      h0.textContent = "Parámetro";
      hr.appendChild(h0);

      enabledCookers.forEach(c => {
        const th = document.createElement("th");
        th.className = "text-center";
        th.textContent = `C${c}`;
        hr.appendChild(th);
      });
      thead.appendChild(hr);
      table.appendChild(thead);

      // Body
      const tbody = document.createElement("tbody");
      params.forEach(([key,label]) => {
        const tr = document.createElement("tr");
        const th = document.createElement("th");
        th.className = "sticky-col zg-param-name";
        th.textContent = label;
        tr.appendChild(th);

        enabledCookers.forEach(c => {
          const td = document.createElement("td");
          td.className = "text-center";
          const field = `c${c}_${key}`;
          const raw = rec[field];

          const info = classify(field, raw);
          if (hideFO && info.cls === "zg-badge-fo") {
            td.innerHTML = `<span class="text-muted">—</span>`;
          } else if (info.numeric) {
            td.classList.add(info.cls);
            td.innerHTML = `<span class="fw-semibold">${info.label}</span>`;
          } else if (info.cls === "zg-badge-fo") {
            td.innerHTML = `<span class="badge rounded-pill zg-badge-fo">${info.label}</span>`;
          } else {
            td.textContent = info.label;
          }
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);

      const wrap = document.createElement("div");
      wrap.className = "zg-table-wrap";
      wrap.appendChild(table);
      return wrap;
    }

    function render() {
      const root = document.getElementById("content");
      const loading = document.getElementById("loading");
      const exportSection = document.getElementById("exportSection");
      
      // Mostrar loading
      root.innerHTML = "";
      loading.style.display = "block";
      exportSection.style.display = "none";
      
      // Usar setTimeout para permitir que se muestre el indicador de carga
      setTimeout(() => {
        try {
          const data = parseData();
          const order = document.getElementById("sortOrder").value;
          const compact = document.getElementById("toggleCompact").checked;
          const hideFO = document.getElementById("toggleHideFO").checked;
          const enabledCookers = Array.from({length:7}, (_,i) => i+1)
            .filter(n => document.getElementById(`c${n}`).checked);

          const sorted = [...data].sort(order === "asc" ? byHourAsc : byHourDesc);

          // Agrupar por día
          const byDay = {};
          for (const rec of sorted) {
            byDay[rec.dia] ??= [];
            byDay[rec.dia].push(rec);
          }

          Object.entries(byDay).forEach(([dia, records]) => {
            // Día header
            const dayHeader = document.createElement("div");
            dayHeader.className = "mb-3";
            dayHeader.innerHTML = `<h2 class="h5 mb-0">${dia}</h2>
              <div class="zg-meta">Total registros: ${records.length}</div>`;
            root.appendChild(dayHeader);

            // Render cada hora como card
            records.forEach((rec, idx) => {
              const card = document.createElement("div");
              card.className = "card mb-3 zg-hour-card";

              // Resumen por hora
              const summary = buildHourSummary(rec, enabledCookers);
              const titleId = `zg-hour-${dia.replace(/-/g, '')}-${idx}`;

              const header = document.createElement("div");
              header.className = "card-header d-flex flex-wrap align-items-center justify-content-between gap-2";
              header.innerHTML = `
                <div class="d-flex align-items-center gap-3">
                  <span class="badge text-bg-primary-subtle border"><i class="bi bi-clock"></i> ${rec.hora}</span>
                  <div class="zg-meta">
                    <span class="me-3"><i class="bi bi-diagram-3"></i> Proceso <strong>${rec.proceso}</strong></span>
                    <span class="me-3"><i class="bi bi-person"></i> Operador: <strong>${rec.operador}</strong></span>
                    <span class="me-3"><i class="bi bi-person-gear"></i> Supervisor: <strong>${rec.supervisor}</strong></span>
                  </div>
                </div>
                <div class="zg-summary d-flex align-items-center gap-2">
                  <span class="badge text-bg-success-subtle border">OK: ${summary.okCount}</span>
                  <span class="badge text-bg-warning-subtle border">Borderline: ${summary.borderlineCount}</span>
                  <span class="badge text-bg-danger-subtle border">Fuera: ${summary.outCount}</span>
                  <span class="badge text-bg-secondary-subtle border">FO: ${summary.foCount}</span>
                  <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#${titleId}">
                    <i class="bi bi-arrows-expand"></i> Ver detalles
                  </button>
                </div>
              `;

              const body = document.createElement("div");
              body.className = "collapse show"; // abierto por defecto
              body.id = titleId;

              body.appendChild( makeHourMatrix(rec, enabledCookers, compact, hideFO) );

              card.appendChild(header);
              const cardBody = document.createElement("div");
              cardBody.className = "card-body";
              cardBody.appendChild(body);
              card.appendChild(cardBody);
              root.appendChild(card);
            });
          });
          
          // Ocultar loading y mostrar botones de exportación
          loading.style.display = "none";
          if (Object.keys(byDay).length > 0) {
            exportSection.style.display = "block";
          }
        } catch (error) {
          console.error("Error rendering data:", error);
          loading.style.display = "none";
          root.innerHTML = `<div class="alert alert-danger">Error al cargar los datos: ${error.message}</div>`;
        }
      }, 50);
    }

    // Función para exportar a PDF
    function exportToPDF() {
      const loading = document.getElementById("loading");
      loading.style.display = "block";
      
      setTimeout(() => {
        // Ocultar botones durante la exportación
        const exportSection = document.getElementById("exportSection");
        exportSection.style.display = "none";
        
        // Crear un clon del contenido para no afectar la visualización actual
        const contentClone = document.getElementById("content").cloneNode(true);
        
        // Ocultar botones de colapso/expansión en el clon
        const collapseButtons = contentClone.querySelectorAll('[data-bs-toggle="collapse"]');
        collapseButtons.forEach(btn => btn.style.display = 'none');
        
        // Expandir todos los elementos colapsados en el clon
        const collapses = contentClone.querySelectorAll('.collapse');
        collapses.forEach(collapse => {
          collapse.classList.add('show');
        });
        
        // Aplicar estilos para impresión en el clon
        contentClone.querySelectorAll('.zg-hour-card').forEach(card => {
          card.style.boxShadow = 'none';
          card.style.border = '1px solid #ddd';
        });
        
        // Agregar el clon al documento temporalmente
        contentClone.style.position = 'absolute';
        contentClone.style.left = '-9999px';
        document.body.appendChild(contentClone);
        
        // Crear PDF
        html2canvas(contentClone, {
          scale: 2,
          useCORS: true,
          logging: false
        }).then(canvas => {
          // Eliminar el clon
          document.body.removeChild(contentClone);
          
          const imgData = canvas.toDataURL('image/png');
          const pdf = new jsPDF('p', 'mm', 'a4');
          const imgProps = pdf.getImageProperties(imgData);
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
          
          pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
          
          // Agregar metadata
          const title = "Registros Hora por Hora - Cocedores";
          pdf.setProperties({
            title: title,
            subject: 'Reporte de parámetros de cocedores',
            author: 'Zona Gris System',
            keywords: 'cocedores, parámetros, reporte',
            creator: 'Zona Gris System'
          });
          
          // Guardar PDF
          pdf.save(`Reporte_Cocedores_${new Date().toISOString().slice(0,10)}.pdf`);
          
          // Restaurar UI
          loading.style.display = "none";
          exportSection.style.display = "block";
        }).catch(error => {
          console.error("Error generating PDF:", error);
          loading.style.display = "none";
          exportSection.style.display = "block";
          alert("Error al generar el PDF: " + error.message);
        });
      }, 100);
    }

    // ---- Eventos de filtros ----
    document.getElementById("filters").addEventListener("change", render);
    document.getElementById("btnReset").addEventListener("click", () => {
      document.getElementById("sortOrder").value = "desc";
      document.getElementById("toggleCompact").checked = false;
      document.getElementById("toggleHideFO").checked = false;
      for (let i=1;i<=7;i++) document.getElementById(`c${i}`).checked = true;
      render();
    });
    
    // Evento para exportar a PDF
    document.getElementById("btnExportPDF").addEventListener("click", exportToPDF);

    // Render inicial
    document.addEventListener("DOMContentLoaded", render);
  </script>

  <!-- Bootstrap JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>